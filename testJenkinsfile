pipeline {
    agent {
        docker {
            image 'node'  // Use Node.js Docker image for the entire pipeline
            args '-u root'  // Run as root user to avoid permission issues
        }
    }

    stages {
        stage('Install Dependencies') {
            steps {
                // Override the default .npm cache directory to a writable location
                sh 'npm install --cache .npm --prefer-offline'
            }
        }

        stage('Package Application') {
            steps {
                // Package the application
                sh 'npm pack'
            }
        }

        stage('Upload App to Artifact') {
            steps {
                // Upload the application to Artifactory
                sh 'curl -u admin:AP8gcgmmset5jeYChTJYDN6XmDd -T *.tgz "http://ec2-54-205-94-62.compute-1.amazonaws.com:8081/artifactory/utc-nodejs/my-app-${BUILD_ID}.tgz"'
            }
        }
    }
}


